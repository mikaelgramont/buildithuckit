<link rel="import" href="../components/polymer/polymer.html">

<dom-module id="bihi-design-parameter">
  <style>
      :host {
        display: block;
        margin: 10px 0;
      }
      label,
      .caption {
        display: block;
      }
      input {
        display: block;
        width: 100%;
        margin: 5px 0;
      }
      input[disabled] {
        display: none;
      }
  </style>

  <template>
    <label>
      <span class="caption size-2">
        <span>{{caption}}</span>:
        <span>{{displayValue}}</span>
      </span>
      <input id="slider" type="range" min="{{min}}" max="{{max}}"
        step="{{step}}" value="{{value}}" on-change="onChange" on-input="onInput" >
    </label>
  </template>

</dom-module>

<script>
  Polymer({
    is: "bihi-design-parameter",
    properties: {
      caption: {type: String},
      units: {type: String, observer: "updateUnits"},
      disabled: {type: Boolean, reflectToAttribute: true, observer: "onDisableChange"},
      displayValue: {type: String},
      max: {type: Number},
      min: {type: Number},
      step: {type: Number},
      value: {type: Number, reflectToAttribute: true, observer: "updateDisplay"}
    },
    ready: function() {
      this.updateDisplay(this.value);
    },
    onInput: function(e) {
      this.updateDisplay(e.target.value);
    },
    updateUnits: function(e) {
      this.updateDisplay(this.value);
    },
    updateDisplay: function(value) {
      if (this.units == 'ft') {
        this.displayValue = Utils.metersToDumb(value);
      } else {
        this.displayValue = value + this.units;
      }
    },
    onDisableChange: function(newValue) {
      this.$.slider.disabled = newValue;
    },
    onChange: function(e) {
      // Update the actual property.
      this.value = e.target.value;
      this.updateDisplay(this.value);
      this.fire("parameter-change", this.value);

      // TODO: snap to the closest displayable value for the current units.
    }
  });
</script>