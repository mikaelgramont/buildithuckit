<link rel="import" href="../bower_components/polymer/polymer.html">

<script src="../bower_components/threejs/build/three.min.js"></script>
<script src="../scripts/config.js"></script>
<script src="../scripts/imagelist.js"></script>
<script src="../scripts/utils.js"></script>
<script src="../scripts/kickereditorview.js"></script>
<script src="../scripts/kickermodel.js"></script>
<script src="../scripts/kicker.js"></script>
<script src="../scripts/ColladaLoader.js"></script> 
<script src="../scripts/THREEx.GeometryUtils.js"></script> 
<script src="../scripts/representation3d.js"></script>
<script src="../scripts/scene.js"></script>
<script src="../scripts/scene.js"></script>
<script src="../scripts/orbitcontrols.js"></script>

<script src="../models/parts/part.js"></script>
<script src="../models/parts/side.js"></script>
<script src="../models/parts/slat.js"></script>
<script src="../models/parts/strut.js"></script>
<script src="../models/parts/surface.js"></script>

<script src="../scripts/renderer3d.js"></script>

<dom-module id="bihi-renderer3d">
  <style>
    :host {
      margin-right: 20px;
      flex-grow: 1;
      box-sizing: border-box;
    }
    canvas {
      width: 100%;
      height: 100%;
    }
  </style>

  <template>
    <canvas></canvas>
  </template>

</dom-module>

<script>
  Polymer({
    is: "bihi-renderer3d",
    listeners: {
      "renderer-refresh": "refresh"
    },
    properties: {
      renderer: {type: Object},
      editorId: {type: String}
    },
    ready: init,
    refresh: function() {
      this.renderer.refresh();
    },
    resize: function() {
      this.renderer.resize();
    }
  });

  function init() {
    var editorEl = document.getElementById(this.editorId),
        canvasEl = Polymer.dom(this).node.querySelector('canvas'),
        view = new KickerEditorView(editorEl),
        model = new KickerModel(view),
        kicker = new Kicker(model),
        imageList = new ImageList();
    this.renderer = new Renderer3d(kicker, canvasEl, imageList, config);

    var resizeTimeoutHandle = null;

    var onResize = (function() {
      if (resizeTimeoutHandle) {
        clearTimeout(resizeTimeoutHandle);
      }
      resizeTimeoutHandle = setTimeout((function() {
        this.renderer.resize();    
      }).bind(this), 200);
    }).bind(this);
    window.addEventListener('resize', onResize);
  }
</script>